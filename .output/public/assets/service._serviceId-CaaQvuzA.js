import{c as T,g as A,u as $,b as q,a as p,r as i,d as L,j as e,L as U}from"./index-5PltJSx_.js";import{a as o}from"./api-Df4qyv35.js";import{A as _}from"./arrow-left-C7m3PQ5f.js";import{M as H}from"./map-pin-DKGBZGve.js";import{D as R}from"./dollar-sign-9c2JrQNw.js";import{C as w}from"./calendar-DGhMDcJ7.js";import{M as E}from"./message-circle-B0O43-wu.js";const F=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],z=T("square-pen",F);function X(){const{serviceId:S}=A.useParams(),{userId:B}=$(),c=q(),d=p(o.users.getCurrentUser,{clerkId:B??""}),s=p(o.services.getService,{serviceId:S}),r=p(o.users.getUser,{userId:s?.userId??""}),[I,m]=i.useState(!1),[x,h]=i.useState(""),[u,f]=i.useState(""),[l,b]=i.useState("1"),[j,v]=i.useState(""),[N,y]=i.useState(!1),[g,n]=i.useState(""),D=L(o.bookings.createBooking);if(!s)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsx("p",{children:"Loading service..."})})});const k=d?._id===s.userId,C=parseFloat(l)*s.pricePerHour,M=()=>{c.navigate({to:"/messages"})},P=async a=>{if(a.preventDefault(),!d||!s.userId){n("Please log in to book a service");return}if(!x||!u){n("Please select date and time");return}y(!0),n("");try{const t=new Date(`${x}T${u}`).getTime();await D({bookerId:d._id,serviceId:s._id,ownerId:s.userId,scheduledDate:t,duration:parseInt(l),notes:j}),n("Booking request sent successfully!"),setTimeout(()=>{m(!1),h(""),f(""),b("1"),v(""),c.navigate({to:"/bookings"})},1500)}catch{n("Failed to book service. Please try again.")}finally{y(!1)}};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>c.navigate({to:"/discover"}),className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(_,{className:"h-5 w-5"}),"Back to Discover"]})}),e.jsxs("div",{className:"bg-card border rounded-lg overflow-hidden mb-6",children:[s.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-1",children:s.images.slice(0,4).map((a,t)=>e.jsx("img",{src:`/api/storage/${a}`,alt:`Service image ${t+1}`,className:`w-full h-48 object-cover ${t===0&&s.images.length>1?"col-span-2":""}`},a))}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-1 rounded-md text-sm",children:s.category}),s.isActive&&e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-md text-sm",children:"Active"})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:s.location})]})]}),k&&e.jsxs(U,{to:"/service/$serviceId/edit",params:{serviceId:s._id},className:"inline-flex items-center gap-2 px-4 py-2 border rounded-md hover:bg-muted transition-colors",children:[e.jsx(z,{className:"h-4 w-4"}),"Edit"]})]}),e.jsx("div",{className:"flex items-center gap-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("span",{className:"text-2xl font-bold",children:["₱",s.pricePerHour]}),e.jsx("span",{className:"text-muted-foreground",children:"/hour"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Description"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.description})]}),s.tags.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(a=>e.jsx("span",{className:"bg-muted px-3 py-1 rounded-full text-sm",children:a},a))})]}),s.availability.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Availability"}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-2",children:s.availability.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 bg-muted px-3 py-2 rounded-md text-sm",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a})]},t))})]})]})]}),e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"About the Service Provider"}),r?e.jsxs("div",{className:"flex items-center gap-4",children:[r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:r.fullName,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary flex items-center justify-center text-white font-semibold text-2xl",children:r.fullName.substring(0,2)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:r.fullName}),e.jsx("p",{className:"text-muted-foreground",children:r.username&&`@${r.username}`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 border rounded-md hover:bg-muted transition-colors",children:[e.jsx(E,{className:"h-4 w-4"}),"Message"]}),!k&&e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors",children:[e.jsx(w,{className:"h-4 w-4"}),"Book Now"]})]})]}):e.jsx("p",{children:"Loading provider information..."})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card border rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Book ",s.title]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date"}),e.jsx("input",{type:"date",value:x,onChange:a=>h(a.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Time"}),e.jsx("input",{type:"time",value:u,onChange:a=>f(a.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Duration (hours)"}),e.jsx("input",{type:"number",value:l,onChange:a=>b(a.target.value),min:"1",max:"24",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{children:[l," hour",l!=="1"?"s":""]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rate:"}),e.jsxs("span",{children:["₱",s.pricePerHour,"/hour"]})]}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["₱",C.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:j,onChange:a=>v(a.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary min-h-[100px]",placeholder:"Any special requests or notes..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),n("")},className:"flex-1 px-4 py-2 border rounded-md hover:bg-muted transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N,className:"flex-1 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Booking...":"Confirm Booking"})]}),g&&e.jsx("p",{className:`text-sm text-center ${g.includes("success")?"text-green-600":"text-red-600"}`,children:g})]})]})})]})})}export{X as component};
