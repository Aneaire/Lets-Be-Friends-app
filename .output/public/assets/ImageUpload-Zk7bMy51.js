import{c as g,r as p,d as U,j as e}from"./index-5PltJSx_.js";import{a as k}from"./api-Df4qyv35.js";const _=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],M=g("cloud-upload",_);const $=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],C=g("image",$);const P=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],q=g("save",P);const R=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],I=g("x",R);function A({maxImages:s=5,onImagesChange:m,defaultImages:h=[],accept:f="image/*",className:u=""}){const[a,l]=p.useState(h),[n,o]=p.useState(!1),d=p.useRef(null),x=U(k.storage.generateUploadUrl),y=async r=>{const t=r.target.files;if(t){if(a.length+t.length>s){alert(`Maximum ${s} images allowed`);return}o(!0);try{const i=[];for(let j=0;j<t.length;j++){const v=t[j];if(v.type.startsWith("image/")){const w=await x();if(!(await fetch(w,{method:"PUT",headers:{"Content-Type":v.type},body:v})).ok)throw new Error("Upload failed");const S=w.split("/").pop();i.push(Promise.resolve(S??""))}}const c=await Promise.all(i),N=[...a,...c];l(N),m(N)}catch(i){console.error("Upload error:",i),alert("Failed to upload images. Please try again.")}finally{o(!1)}d.current&&(d.current.value="")}},b=r=>{const t=a.filter((i,c)=>c!==r);l(t),m(t)};return e.jsxs("div",{className:`space-y-3 ${u}`,children:[e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[a.map((r,t)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:`/api/storage/${r}`,alt:`Upload ${t+1}`,className:"h-24 w-24 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>b(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove image",children:e.jsx(I,{className:"h-3 w-3"})})]},r)),a.length<s&&e.jsx("button",{type:"button",onClick:()=>d.current?.click(),disabled:n,className:"h-24 w-24 rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-6 w-6 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Add Image (",a.length+1,"/",s,")"]})]})})]}),e.jsx("input",{ref:d,type:"file",accept:f,multiple:!0,disabled:n||a.length>=s,onChange:y,className:"hidden"})]})}function H({onImageChange:s,defaultImage:m,accept:h="image/*",className:f=""}){const[u,a]=p.useState(m??null),[l,n]=p.useState(!1),o=p.useRef(null),d=U(k.storage.generateUploadUrl),x=async b=>{const r=b.target.files?.[0];if(r){n(!0);try{const t=await d();if(!(await fetch(t,{method:"PUT",headers:{"Content-Type":r.type},body:r})).ok)throw new Error("Upload failed");const c=t.split("/").pop()??"";a(c),s(c)}catch(t){console.error("Upload error:",t),alert("Failed to upload image. Please try again.")}finally{n(!1)}o.current&&(o.current.value="")}},y=()=>{a(null),s(null)};return e.jsxs("div",{className:f,children:[u?e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("img",{src:`/api/storage/${u}`,alt:"Uploaded image",className:"h-32 w-32 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:y,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove image",children:e.jsx(I,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"relative inline-block",children:e.jsx("button",{type:"button",onClick:()=>o.current?.click(),disabled:l,className:"h-32 w-32 rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Upload Image"})]})})}),e.jsx("input",{ref:o,type:"file",accept:h,disabled:l&&!!u,onChange:x,className:"hidden"})]})}export{A as I,q as S,I as X,H as a};
