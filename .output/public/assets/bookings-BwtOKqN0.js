import{c as u,u as B,a as y,r as N,d as v,j as e}from"./index-5PltJSx_.js";import{a as p}from"./api-Df4qyv35.js";import{w as S}from"./auth-BhrcrAHN.js";import{C as A}from"./calendar-DGhMDcJ7.js";import{D as M}from"./dollar-sign-9c2JrQNw.js";const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],L=u("circle-alert",I);const $=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],b=u("circle-check-big",$);const R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],U=u("circle-x",R);const D=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],z=u("clock",D);const P=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],E=u("ellipsis",P);const q=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],F=u("file-text",q);function H(){const{userId:t}=B(),a=y(p.users.getCurrentUser,{clerkId:t??""}),[r,n]=N.useState("my"),[c,i]=N.useState("all"),d=y(p.bookings.listBookings,{userId:a?._id??"",role:"booker"}),m=y(p.bookings.listBookings,{userId:a?._id??"",role:"owner"}),h=v(p.bookings.updateBookingStatus),g=v(p.bookings.uploadReceipt),l=(r==="my"?d:m)?.filter(s=>c==="all"?!0:s.status===c)??[],k=(s,x,o)=>{h({bookingId:s,status:x,paymentLink:o})},w=(s,x,o)=>{g({bookingId:s,receiptType:x,receiptUrl:o})},C=s=>{const x={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending",icon:L},accepted:{color:"bg-blue-100 text-blue-800",label:"Accepted",icon:b},completed:{color:"bg-green-100 text-green-800",label:"Completed",icon:b},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled",icon:U}},o=x[s]??x.pending,_=o.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${o.color}`,children:[e.jsx(_,{className:"h-3 w-3"}),o.label]})};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Bookings"}),e.jsx("div",{className:"mb-6 border-b",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsx("button",{onClick:()=>n("my"),className:`pb-4 font-medium transition-colors ${r==="my"?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground"}`,children:"My Bookings"}),e.jsx("button",{onClick:()=>n("service"),className:`pb-4 font-medium transition-colors ${r==="service"?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground"}`,children:"Service Bookings"})]})}),e.jsx("div",{className:"mb-6 flex gap-3 flex-wrap",children:e.jsxs("select",{value:c,onChange:s=>i(s.target.value),className:"border rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsx("div",{className:"bg-card border rounded-lg p-12 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["No ",c==="all"?"":`${c} `,"bookings found."]})}):l.map(s=>e.jsx(T,{booking:s,activeTab:r,onStatusUpdate:k,onUploadReceipt:w,getStatusBadge:C},s._id))})]})})}function T({booking:t,activeTab:a,onStatusUpdate:r,onUploadReceipt:n,getStatusBadge:c}){const[i,d]=N.useState(!1),m=a==="service",h=t.status==="pending",g=t.status==="accepted",f=t.status==="completed";return e.jsx("div",{className:"bg-card border rounded-lg p-6 hover:border-primary/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c(t.status),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Booking ",t._id.substring(0,8),"..."]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:m?"Booking for Service":"Your Booking"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>d(!i),className:"p-1 hover:bg-muted rounded",children:e.jsx(E,{className:"h-5 w-5 text-muted-foreground"})}),i&&e.jsxs("div",{className:"absolute right-0 top-8 bg-card border rounded-md shadow-lg p-1 min-w-[150px] z-10",children:[h&&m&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{r(t._id,"accepted"),d(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded",children:"Accept"}),e.jsx("button",{onClick:()=>{r(t._id,"cancelled"),d(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded text-red-600",children:"Reject"})]}),h&&!m&&e.jsx("button",{onClick:()=>{r(t._id,"cancelled"),d(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded text-red-600",children:"Cancel"}),f&&!t.paymentLink&&m&&e.jsx("button",{onClick:()=>{const l=`https://checkout.paymongo.com/example/${t._id}`;r(t._id,"completed",l),d(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded",children:"Send Payment Link"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[new Date(t.scheduledDate).toLocaleDateString()," at"," ",new Date(t.scheduledDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[t.duration," hours"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-semibold",children:["â‚±",t.totalPrice]})]})]}),t.notes&&e.jsx("div",{className:"bg-muted p-3 rounded-md mb-4",children:e.jsx("p",{className:"text-sm",children:t.notes})}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),"Receipts"]}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-2",children:[e.jsx(j,{type:"Start",url:t.receiptStart,onUpload:l=>n(t._id,"start",l)}),e.jsx(j,{type:"Middle",url:t.receiptMiddle,onUpload:l=>n(t._id,"middle",l)}),e.jsx(j,{type:"End",url:t.receiptEnd,onUpload:l=>n(t._id,"end",l)})]})]})]}),e.jsxs("div",{className:"lg:w-64",children:[g&&t.paymentLink&&e.jsx("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",className:"block w-full bg-primary text-primary-foreground text-center px-4 py-2 rounded-md font-medium hover:bg-primary/90 transition-colors mb-2",children:"Pay Now"}),f&&t.paymentId&&e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Payment ID: ",t.paymentId]})]})]})})}function j({type:t,url:a,onUpload:r}){return e.jsxs("div",{className:"border rounded-md p-3 text-center",children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:[t," Receipt"]}),a?e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:"View"}):e.jsxs("label",{className:"text-sm text-muted-foreground hover:text-foreground cursor-pointer",children:["Upload",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:n=>{const c=n.target.files?.[0];if(c){const i=URL.createObjectURL(c);r(i)}}})]})]})}const Z=S(H);export{Z as component};
