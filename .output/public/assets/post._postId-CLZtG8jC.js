import{c as k,i as B,u as b,b as H,a as c,r as p,d as j,j as e}from"./index-5PltJSx_.js";import{a as l}from"./api-Df4qyv35.js";import{A as q}from"./arrow-left-C7m3PQ5f.js";import{M as E}from"./map-pin-DKGBZGve.js";import{H as v}from"./heart-bZLsMFrj.js";import{M as I}from"./message-circle-B0O43-wu.js";import{S as F}from"./send-9tvlxndf.js";const V=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],z=k("bookmark",V);const Q=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],W=k("share-2",Q);function te(){const{postId:a}=B.useParams(),{userId:h}=b(),o=H(),t=c(l.users.getCurrentUser,{clerkId:h??""}),s=c(l.posts.getPost,{postId:a}),i=c(l.users.getUser,{userId:s?.userId??""}),x=c(l.comments.listComments,{postId:a}),n=c(l.posts.isPostLiked,{userId:t?._id??"",postId:a}),f=c(l.posts.isPostSaved,{userId:t?._id??"",postId:a}),[d,m]=p.useState(""),[g,N]=p.useState(null),[C,_]=p.useState({}),[y,w]=p.useState(!1),U=j(l.posts.toggleLike),L=j(l.posts.savePost),$=j(l.comments.createComment),S=j(l.comments.toggleLike);if(!s)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsx("p",{children:"Loading post..."})})});const P=()=>{t&&U({userId:t._id,postId:s._id})},R=()=>{t&&L({userId:t._id,postId:s._id})},A=()=>{!t||!d.trim()||(w(!0),$({postId:s._id,userId:t._id,parentCommentId:g,content:d}).finally(()=>{m(""),N(null),w(!1)}))},T=(r,u)=>{N(r),m(`@${u} `)},D=r=>{t&&S({userId:t._id,commentId:r})},M=r=>x?.filter(u=>u.parentCommentId===r)??[];return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>o.navigate({to:"/dashboard"}),className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(q,{className:"h-5 w-5"}),"Back to Dashboard"]})}),e.jsxs("div",{className:"bg-card border rounded-lg overflow-hidden mb-6",children:[s.images.length>0&&e.jsxs("div",{className:"grid gap-1",children:[s.images.length===1&&e.jsx("img",{src:`/api/storage/${s.images[0]}`,alt:"Post image",className:"w-full h-auto max-h-[600px] object-cover"}),s.images.length===2&&e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("img",{src:`/api/storage/${s.images[0]}`,alt:"Post image 1",className:"w-full h-80 object-cover"}),e.jsx("img",{src:`/api/storage/${s.images[1]}`,alt:"Post image 2",className:"w-full h-80 object-cover"})]}),s.images.length>=3&&e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("img",{src:`/api/storage/${s.images[0]}`,alt:"Post image 1",className:"w-full h-80 object-cover"}),e.jsxs("div",{className:"grid grid-rows-2 gap-1",children:[e.jsx("img",{src:`/api/storage/${s.images[1]}`,alt:"Post image 2",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`/api/storage/${s.images[2]}`,alt:"Post image 3",className:"w-full h-full object-cover"}),s.images.length>3&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-2xl font-semibold",children:["+",s.images.length-3]})]})]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i&&e.jsxs("div",{className:"flex items-center gap-3",children:[i.avatarUrl?e.jsx("img",{src:i.avatarUrl,alt:i.fullName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-semibold text-xl",children:i.fullName.substring(0,2)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.username&&`@${i.username}`})]})]}),e.jsx("button",{className:"p-2 hover:bg-muted rounded-md",children:e.jsx(W,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx("p",{className:"mb-4 whitespace-pre-wrap",children:s.caption}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.map(r=>e.jsxs("span",{className:"bg-primary/10 text-primary px-3 py-1 rounded-full text-sm",children:["#",r]},r))}),s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-4 border-t border-b py-4 my-4",children:[e.jsxs("button",{onClick:P,disabled:!t,className:`flex items-center gap-2 hover:bg-muted px-3 py-2 rounded-md transition-colors ${n?"text-red-500":"text-foreground"}`,children:[e.jsx(v,{className:`h-5 w-5 ${n?"fill-current":""}`}),e.jsx("span",{children:s.likesCount})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:bg-muted px-3 py-2 rounded-md transition-colors",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{children:s.commentsCount})]}),e.jsx("button",{onClick:R,disabled:!t,className:`flex items-center gap-2 hover:bg-muted px-3 py-2 rounded-md transition-colors ${f?"text-primary":"text-foreground"}`,children:e.jsx(z,{className:`h-5 w-5 ${f?"fill-current":""}`})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]})]}),e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Comments"}),t&&e.jsxs("div",{className:"mb-6",children:[g&&e.jsxs("div",{className:"flex items-center justify-between bg-muted px-4 py-2 rounded-md mb-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Replying to comment"}),e.jsx("button",{onClick:()=>{N(null),m("")},className:"text-sm text-red-500 hover:text-red-600",children:"Cancel"})]}),e.jsxs("div",{className:"flex gap-3",children:[t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:t.fullName,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-semibold flex-shrink-0",children:t.fullName.substring(0,2)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:d,onChange:r=>m(r.target.value),placeholder:"Write a comment...",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary min-h-[80px]"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("button",{onClick:A,disabled:!d.trim()||y,className:"flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(F,{className:"h-4 w-4"}),y?"Posting...":"Post Comment"]})})]})]})]}),e.jsx("div",{className:"space-y-4",children:x&&x.length>0?x.filter(r=>!r.parentCommentId).map(r=>e.jsx(G,{comment:r,authorId:r.userId,replies:M(r._id),onReply:T,onLike:D,showReplies:C[r._id]??!1,onToggleReplies:()=>_(u=>({...u,[r._id]:!u[r._id]}))},r._id)):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No comments yet. Be the first to comment!"})})]})]})})}function G({comment:a,authorId:h,replies:o,onReply:t,onLike:s,showReplies:i,onToggleReplies:x}){const n=c(l.users.getUser,{userId:h}),{userId:f}=b(),d=c(l.users.getCurrentUser,{clerkId:f??""}),m=c(l.comments.isCommentLiked,{userId:d?._id??"",commentId:a._id});return e.jsx("div",{className:"flex gap-3",children:n?e.jsxs(e.Fragment,{children:[n.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:n.fullName,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-semibold flex-shrink-0",children:n.fullName.substring(0,2)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:n.fullName}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n.username&&`@${n.username}`}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]})}),e.jsx("p",{className:"mb-3 whitespace-pre-wrap",children:a.content}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("button",{onClick:()=>s(a._id),disabled:!d,className:`flex items-center gap-1 hover:text-foreground transition-colors ${m?"text-red-500":"text-muted-foreground"}`,children:[e.jsx(v,{className:`h-4 w-4 ${m?"fill-current":""}`}),e.jsx("span",{children:a.likesCount})]}),e.jsxs("button",{onClick:()=>n&&t(a._id,n.username||n.fullName),disabled:!d,className:"flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(I,{className:"h-4 w-4"}),"Reply"]})]})]}),o.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:x,className:"text-sm text-primary hover:text-primary/80",children:[i?"Hide":"View"," ",o.length," ",o.length===1?"reply":"replies"]}),i&&e.jsx("div",{className:"mt-3 space-y-3",children:o.map(g=>e.jsx(J,{reply:g,onLike:s},g._id))})]})]})]}):null})}function J({reply:a,onLike:h}){const o=c(l.users.getUser,{userId:a.userId}),{userId:t}=b(),s=c(l.users.getCurrentUser,{clerkId:t??""}),i=c(l.comments.isCommentLiked,{userId:s?._id??"",commentId:a._id});return e.jsx("div",{className:"flex gap-3",children:o?e.jsxs(e.Fragment,{children:[o.avatarUrl?e.jsx("img",{src:o.avatarUrl,alt:o.fullName,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white font-semibold flex-shrink-0 text-sm",children:o.fullName.substring(0,2)}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:o.fullName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm mb-2 whitespace-pre-wrap",children:a.content}),e.jsxs("button",{onClick:()=>h(a._id),disabled:!s,className:`text-xs flex items-center gap-1 hover:text-foreground transition-colors ${i?"text-red-500":"text-muted-foreground"}`,children:[e.jsx(v,{className:`h-3 w-3 ${i?"fill-current":""}`}),e.jsx("span",{children:a.likesCount})]})]})})]}):null})}export{te as component};
